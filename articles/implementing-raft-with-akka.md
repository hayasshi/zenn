---
title: "Akka „Åß Raft „ÇíÂÆüË£Ö„Åó„Å¶„Åø„ÅüË©±"
emoji: "ü™µ"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["Raft", "Scala", "Akka", "Pekko"]
published: true
---

„Åì„Çå„ÅØ Scala Advent Calendar 2023 „ÅÆ 10 Êó•ÁõÆ„ÅÆË®ò‰∫ã„Åß„Åô„ÄÇ(Á©∫„ÅÑ„Å¶„ÅÑ„Åü„ÅÆ„ÅßÂüã„ÇÅ„Åæ„Åó„Åü)

@[card](https://qiita.com/advent-calendar/2023/scala)

ÊúÄËøë„ÅÆÂàÜÊï£„Éá„Éº„Çø„Éô„Éº„Çπ„Åß„Çà„ÅèËÅû„Åè Raft „Å´„Å§„ÅÑ„Å¶„ÄÅ„Åù„ÅÆË´ñÊñá„ÇíË™≠„Çì„Åß„Åø„Åü„Å®„Åì„ÇçÂü∫Êú¨ÁöÑ„Å™ÈÉ®ÂàÜ„ÅØ„Ç∑„É≥„Éó„É´„ÅßÁêÜËß£„Åó„ÇÑ„Åô„Åè„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ„Çä„ÅÇ„ÅÑ„ÄÅ„É≠„Ç∞„Çí„Å§„Åã„Å£„Å¶Ëá™ÂàÜ„ÅÆÁä∂ÊÖã„ÇíÂ§âÊõ¥„Åó„Å¶„ÅÑ„Åè„Çπ„ÉÜ„Éº„Éà„Éû„Ç∑„É≥„É¢„Éá„É´„Åß„ÅÇ„Å£„Åü„Åü„ÇÅ„ÄÅ„ÄåAkka „Åß„ÅÑ„ÅÑÊÑü„Åò„Å´ÂÆüË£Ö„Åß„Åç„Åù„ÅÜ„Å†„Å™„Äç„Å®ÊÄù„ÅÑ„ÄÅ„ÇÑ„Å£„Å¶„Åø„Åæ„Åó„Åü„ÄÇ

## Raft „Å®„ÅØ

Raft „ÅØ„ÄÅÂàÜÊï£„Ç∑„Çπ„ÉÜ„É†‰∏ä„ÅÆ„Éó„É≠„Çª„ÇπÈñì„Åß„É≠„Ç∞„ÇíË§áË£Ω„Åó„ÄÅ„Åù„Çå„Çí„Å§„Åã„Å£„ÅüÁä∂ÊÖãÂ§âÊõ¥(ÈÅ∑Áßª)„ÅÆÂêàÊÑè(„Ç≥„É≥„Çª„É≥„Çµ„Çπ)„Çí‰øùË®º„Åó„Å¶„Åè„Çå„Åæ„Åô„ÄÇ
Âêå„ÅòÂàÜÊï£ÂêàÊÑè„Ç¢„É´„Ç¥„É™„Ç∫„É†„Åß„ÅÇ„Çã Paxos „Çà„ÇäÁêÜËß£„Åó„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´Ë®≠Ë®à„Åï„Çå„Å¶„Åä„Çä„ÄÅ„Ç≥„É≥„Çª„É≥„Çµ„Çπ„ÅÆ„Åü„ÇÅ„ÅÆË¶ÅÁ¥†„ÇíÂàÜ„Åë„Å¶ÂÆöÁæ©„Åô„Çã„Åì„Å®„Åß„ÄÅ„Åù„Çå„Åû„Çå„ÅåÊØîËºÉÁöÑ„Ç∑„É≥„Éó„É´„Å™„ÇÇ„ÅÆ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÁêÜËß£„Åó„ÇÑ„Åô„Åè„ÄÅ„Ç∑„É≥„Éó„É´„Å´„Åô„Çã„Åì„Å®„Åß„ÄÅÂÆüÁî®ÁöÑ„Å™„Ç∑„Çπ„ÉÜ„É†„ÇíÊßãÁØâ„Åó„ÄÅÁâπ„Å´ÈÅãÁî®„Åó„Å¶„ÅÑ„Åè„Åü„ÇÅ„ÅÆ„Çà„ÇäËâØ„ÅÑÈÅ∏ÊäûËÇ¢„Å´„Å™„Çã„Åì„Å®„ÇíÁõÆÁöÑ„Å®„Åó„Å¶„ÅÑ„Çã„Çà„ÅÜ„Åß„Åô„ÄÇ

Ë©≥„Åó„Åè„ÅØË´ñÊñá„ÇÑ„ÄÅRaft „ÅÆ Web „Çµ„Ç§„Éà„ÇíÈñ≤Ë¶ß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

- [Raft paper](https://raft.github.io/raft.pdf)
- [The Raft Consensus Algorithm](https://raft.github.io/)

Ë´ñÊñá„ÇíË™≠„Çì„Å†„ÇäÂÆüË£Ö„Åô„Çã„Å´„ÅÇ„Åü„Çä„ÄÅ‰∏ãË®ò„ÅÆÈÇ¶Ë®≥„ÇÑËÄÉÂØü„ÇíÂèÇËÄÉ„Å´„Åï„Åõ„Å¶„ÇÇ„Çâ„ÅÑ„Åæ„Åó„Åü„ÄÇ

- [Ë´ñÊñáÁøªË®≥: In Search of an Understandable Consensus Algorithm (Extended Version)](https://hazm.at/mox/distributed-system/algorithm/transaction/raft/index.html)
- [ÂàÜÊï£ÂêàÊÑè„Ç¢„É´„Ç¥„É™„Ç∫„É† Raft „ÇíÁêÜËß£„Åô„Çã](https://qiita.com/torao@github/items/5e2c0b7b0ea59b475cce)
- [NewSQL„ÅÆ„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàË©≥Ëß£](https://qiita.com/tzkoba/items/3e875e5a6ccd99af332f)

ÊúÄËøë„ÅÆÂàÜÊï£„Éá„Éº„Çø„Éô„Éº„Çπ„ÄÅ„Éá„Éº„Çø„Çπ„Éà„Ç¢„ÇÑ NewSQL „Å®Ë®Ä„Çè„Çå„Çã„Çà„ÅÜ„Å™„Éá„Éº„Çø„Éô„Éº„Çπ„Åß„Å§„Åã„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ

- etcd
- Kafka(KRaft)
- TiDB, CockroachDB, YugabyteDB

## „Å™„Åú Akka „ÅßÂÆüË£Ö„Åó„Åü„ÅÆ„Åã

ÂÜíÈ†≠„Å´Ë®òËºâ„Åó„ÅüÈÄö„Çä„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ„ÇäÂêà„ÅÑ„ÄÅ„Åù„ÅÆ„Çπ„ÉÜ„Éº„Éà„ÇíÂ§âÊõ¥„Åó„Å¶„ÅÑ„Åè„Çπ„ÉÜ„Éº„Éà„Éû„Ç∑„É≥„ÅÆË®òËø∞„ÅØ„ÄÅ„Ç¢„ÇØ„Çø„Éº„É¢„Éá„É´„Åù„ÅÆ„ÇÇ„ÅÆ„Å™„Ç§„É°„Éº„Ç∏„Åå„ÅÇ„Çä„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å´ÂÆüË£Ö„Åß„Åç„Çã„ÅãË©¶„Åó„Å¶„Åø„Åü„Åã„Å£„Åü„Åì„Å®„ÅåÂ§ß„Åç„ÅÑ„Åß„Åô„ÄÇ
Raft „ÅØ„ÄÅLeader, Follower, Candidate „ÅÆ‰∏â„Å§„ÅÆÂΩπÂâ≤„ÅåÂÆöÁæ©„Åï„Çå„Å¶„Åä„Çä„ÄÅRequestVote, AppendEntires „Å®„ÅÑ„ÅÜ RPC „Çí‰ªã„Åó„Å¶„Çπ„ÉÜ„Éº„Éà„ÅÆÂ§âÊõ¥„ÇÑÁä∂ÊÖãÈÅ∑Áßª„Çí„Åä„Åì„Å™„ÅÑ„Åæ„Åô„ÄÇ
„Ç¢„ÇØ„Çø„Éº„É¢„Éá„É´„ÅØ„Åæ„Åï„Å´„Åù„Çå„Çâ„Çí„É°„ÉÉ„Çª„Éº„Ç∏„Å®„Åó„Å¶„ÇÑ„ÇäÂèñ„Çä„Åó„ÄÅ„Åù„ÅÆÂÜÖÂÆπ„Å´Âü∫„Å•„ÅÑ„Å¶ÊåØ„ÇãËàû„ÅÑ„ÇíÂ§âÊõ¥„Åß„Åç„Çã„Çπ„ÉÜ„Éº„Éà„Éû„Ç∑„É≥„ÅÆË®òËø∞„Å´„Å™„Çã„Åü„ÇÅ„ÄÅËá™ÁÑ∂„Å´ÂÆüË£Ö„Åß„Åç„Çã„ÅÆ„Åß„ÅØ„Å®ËÄÉ„Åà„Åæ„Åó„Åü„ÄÇ

„Åæ„ÅüAkka „Å´„ÅØ AkkaCluster „Åß„Åô„Åß„Å´„ÄÅ„Ç¥„Ç∑„ÉÉ„Éó„Éó„É≠„Éà„Ç≥„É´„Éô„Éº„Çπ„ÅÆ„ÇØ„É©„Çπ„Çø„É™„É≥„Ç∞Ê©üËÉΩ(„É¢„Ç∏„É•„Éº„É´)„Åå„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅÂà•„ÅÆÂàÜÊï£Âá¶ÁêÜ„ÅÆ‰ªïÁµÑ„Åø„Åå„ÅÇ„Å£„Å¶„ÇÇËâØ„Åï„Åù„ÅÜ„Å†„Å®„ÇÇÊÄù„ÅÑ„Åæ„Åó„Åü„ÄÇ

ÂÆüË£ÖÊôÇÊúü„ÅÆÈÉΩÂêà‰∏ä„ÄÅ[Apache Pekko](https://pekko.apache.org/) „ÅØ‰Ωø„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì„Åå„ÄÅAkka 2.6 (ApacheLicense) „Çí‰Ωø„Å£„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅimport „ÇÑ config Âë®„Çä„ÇíË™øÊï¥„Åô„Çã„Å†„Åë„ÅßÊØîËºÉÁöÑÁ∞°Âçò„Å´ÁßªË°å„Åß„Åç„Çã„ÅÆ„Åß„ÅØÔºü„Å®ÊÄù„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ 

## ÂÆüË£Ö„Åó„Å¶„Åø„Åü

Raft „ÅØË§áÊï∞„ÅÆË¶ÅÁ¥†„Åã„Çâ„Å™„Çä„Åü„Å£„Å¶„Åä„Çä„ÄÅ‰ªäÂõû„ÅØ„Åù„ÅÆÊ†πÂππ„Å®„Å™„Çã„ÄÅ‰∏ãË®ò‰∫å„Å§„ÇíÂÆüË£Ö„Åó„Å¶„Åø„Åæ„Åó„Åü„ÄÇ
- Leader Election
- Log Replication

Log Compaction „ÇÑ Membership Changes „ÇÇ„ÄÅÂÆüÁî®‰∏ä„Åß„ÅØÂøÖÈ†à„Å´„Å™„Çä„Åæ„Åô„Åå„ÄÅRaft „ÅÆ‰ªïÁµÑ„Åø„ÇíÁü•„Çã‰∏ä„Åß„ÅØ„Å®„Çä„ÅÇ„Åà„Åö‰∏äË®ò„Å†„Åë„Åß„Çà„Åï„Åù„ÅÜ„Åß„Åô„ÄÇ

ÂÆüË£Ö„Åó„Åü„Ç≥„Éº„Éâ„ÅØ„Åì„Å°„Çâ„Åß„Åô„ÄÇ

@[card](https://github.com/hayasshi/akka-raft)

README „Åå„Å™„Åã„Å£„Åü„Çä„ÄÅ„Éê„Éº„Ç∏„Éß„É≥„ÅåË´∏„ÄÖÂè§„Åè„Å™„Å£„Å¶„Åó„Åæ„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÅîÂÆπËµ¶„Åè„Å†„Åï„ÅÑüôè
„Åæ„Åü„ÄÅÂÄã‰∫∫ÁöÑ„Å™ÁøíÁÜüÂ∫¶„ÅÆÈñ¢‰øÇ„Åß„ÄÅClassic Actor „ÅßÂÆüË£Ö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

‰ªäÂõû„ÅÆÂÆüË£Ö„ÅØ„ÄÅ„Éó„É≠„Çª„ÇπÂÜÖ„Åß„ÅÆ„Ç®„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„Åæ„Åß„Å®„Å™„Å£„Å¶„Åä„Çä„ÄÅ`RaftTest` „Å®„ÅÑ„ÅÜ„ÉÜ„Çπ„Éà„ÇíÂÆüË°å„Åô„Çã„Å® Raft „Éé„Éº„Éâ„Å´Áõ∏ÂΩì„Åô„Çã„Ç¢„ÇØ„Çø„Éº„Åå‰ΩúÊàê„Åï„Çå„ÄÅ„Åù„Çå„Çâ„Åå„ÇÑ„ÇäÂèñ„Çä„Çí„Åä„Åì„Å™„ÅÑ„Åæ„Åô„ÄÇ
„ÇÑ„ÇäÂèñ„Çä„ÅÆÊßòÂ≠ê„ÅØÊ®ôÊ∫ñÂá∫Âäõ„Å´„É≠„ÇÆ„É≥„Ç∞„Åï„Çå„Åæ„Åô„ÄÇ

‰ª•‰∏ã„ÄÅÂÆüÈöõ„ÅÆÂãï‰Ωú„É≠„Ç∞„ÅÆ‰∏ÄÈÉ®„ÇíË®òËºâ„Åó„Åæ„Åô„ÄÇ
‚ÄªË©≤ÂΩì„É≠„Ç∞„ÅÆ„ÅøÊäúÁ≤ã
‚ÄªË¶ã„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´Â∞ë„ÅóÊîπÂ§â

:::details ÊúÄÂàù„ÅÆ Leader Election „ÅÆ„É≠„Ç∞
```
...
[INFO] [12/25/2023 20:44:12.044] [akka://RaftTest/user/member4] Start raft member with Set(Actor[akka://RaftTest/user/member1#1214893844], Actor[akka://RaftTest/user/member2#882887653], Actor[akka://RaftTest/user/member3#2088407234], Actor[akka://RaftTest/user/member5#659633385])
[INFO] [12/25/2023 20:44:15.708] [akka://RaftTest/user/member4] Follower election timeout
[INFO] [12/25/2023 20:44:15.735] [akka://RaftTest/user/member1] Follower RequestVoteRPC receive RequestVote(1,Actor[akka://RaftTest/user/member4#915776548],0,0)
...
[INFO] [12/25/2023 20:44:15.736] [akka://RaftTest/user/member4] Candidate start election: currentTerm=1, requestedMembers=HashMap(Actor[akka://RaftTest/user/member4#915776548] -> 1, Actor[akka://RaftTest/user/member5#659633385] -> 0, Actor[akka://RaftTest/user/member3#2088407234] -> 0, Actor[akka://RaftTest/user/member2#882887653] -> 0, Actor[akka://RaftTest/user/member1#1214893844] -> 0)
[INFO] [12/25/2023 20:44:15.743] [akka://RaftTest/user/member1] Follower RequestVoteRPC return RequestVoteResult(1,true)
...
[INFO] [12/25/2023 20:44:15.745] [akka://RaftTest/user/member4] Candidate receive voted result: term=1
[INFO] [12/25/2023 20:44:15.748] [akka://RaftTest/user/member4] Candidate receive voted result: term=1
[INFO] [12/25/2023 20:44:15.767] [akka://RaftTest/user/member4] Candidate become to leader: nextIndex=Map(Actor[akka://RaftTest/user/member1#1214893844] -> 1, Actor[akka://RaftTest/user/member2#882887653] -> 1, Actor[akka://RaftTest/user/member3#2088407234] -> 1, Actor[akka://RaftTest/user/member5#659633385] -> 1), matchIndex=Map(Actor[akka://RaftTest/user/member1#1214893844] -> 0, Actor[akka://RaftTest/user/member2#882887653] -> 0, Actor[akka://RaftTest/user/member3#2088407234] -> 0, Actor[akka://RaftTest/user/member5#659633385] -> 0)
...
```
:::

:::details heartbeat ~ Log Replication ~ heatbeat(apply state) „ÅÆ„É≠„Ç∞
```
// heartbeat (‰ªñ„ÅÆ member „Å∏„ÇÇÂêåÊßò„ÅÆ„É≠„Ç∞)
[INFO] [12/25/2023 20:44:21.854] [akka://RaftTest/user/member4] Leader send heartbeat to Actor[akka://RaftTest/user/member5#659633385]: AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(),0)
[INFO] [12/25/2023 20:44:21.855] [akka://RaftTest/user/member5] Follower AppendEntriesRPC receive AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(),0)
[INFO] [12/25/2023 20:44:21.855] [akka://RaftTest/user/member5] Follower AppendEntriesRPC return true: commitIndex=0, lastApplied=0, state=0
[INFO] [12/25/2023 20:44:21.855] [akka://RaftTest/user/member4] Leader receive AppendEntriesResult: AppendEntriesResult(1,true,AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(),0))
...
// Log Replication
[INFO] [12/25/2023 20:44:22.026] [akka://RaftTest/user/member3] Follower redirect command: Command(2), leader=Some(Actor[akka://RaftTest/user/member4#915776548])
[INFO] [12/25/2023 20:44:22.041] [akka://RaftTest/user/member4] Leader receive command from client: Log(1,1,2)

[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member4] Leader send AppendEntries log to Actor[akka://RaftTest/user/member1#1214893844]: AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member1] Follower AppendEntriesRPC receive AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member1] Follower AppendEntriesRPC return true: commitIndex=0, lastApplied=0, state=0

[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member4] Leader send AppendEntries log to Actor[akka://RaftTest/user/member2#882887653]: AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member2] Follower AppendEntriesRPC receive AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member2] Follower AppendEntriesRPC return true: commitIndex=0, lastApplied=0, state=0

[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member4] Leader send AppendEntries log to Actor[akka://RaftTest/user/member3#2088407234]: AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member3] Follower AppendEntriesRPC receive AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member3] Follower AppendEntriesRPC return true: commitIndex=0, lastApplied=0, state=0

[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member4] Leader send AppendEntries log to Actor[akka://RaftTest/user/member5#659633385]: AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member5] Follower AppendEntriesRPC receive AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0)
[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member5] Follower AppendEntriesRPC return true: commitIndex=0, lastApplied=0, state=0

[INFO] [12/25/2023 20:44:22.042] [akka://RaftTest/user/member4] Leader receive AppendEntriesResult: AppendEntriesResult(1,true,AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0))
[INFO] [12/25/2023 20:44:22.043] [akka.actor.ActorSystemImpl(RaftTest)] Test receive Accepted(Command(2))
[INFO] [12/25/2023 20:44:22.044] [akka://RaftTest/user/member4] Leader receive AppendEntriesResult: AppendEntriesResult(1,true,AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0))
[INFO] [12/25/2023 20:44:22.044] [akka://RaftTest/user/member4] Leader commit logs: commitIndex=1, lastApplied=1, state=2
[INFO] [12/25/2023 20:44:22.044] [akka://RaftTest/user/member4] Leader receive AppendEntriesResult: AppendEntriesResult(1,true,AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0))
[INFO] [12/25/2023 20:44:22.044] [akka://RaftTest/user/member4] Leader receive AppendEntriesResult: AppendEntriesResult(1,true,AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],0,0,Vector(Log(1,1,2)),0))
...
// heartbeat (‰ªñ„ÅÆ member „Å∏„ÇÇÂêåÊßò„ÅÆ„É≠„Ç∞)
[INFO] [12/25/2023 20:44:23.553] [akka://RaftTest/user/member4] Leader send heartbeat to Actor[akka://RaftTest/user/member1#1214893844]: AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],1,1,Vector(),1)
[INFO] [12/25/2023 20:44:23.553] [akka://RaftTest/user/member1] Follower AppendEntriesRPC receive AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],1,1,Vector(),1)
[INFO] [12/25/2023 20:44:23.554] [akka://RaftTest/user/member1] Follower AppendEntriesRPC return true: commitIndex=1, lastApplied=1, state=2
[INFO] [12/25/2023 20:44:23.554] [akka://RaftTest/user/member4] Leader receive AppendEntriesResult: AppendEntriesResult(1,true,AppendEntries(1,Actor[akka://RaftTest/user/member4#915776548],1,1,Vector(),1))
...
```
:::

:::details Leader stop ~ Leader Election(ÂÜç) „ÅÆ„É≠„Ç∞
```
[INFO] [12/25/2023 20:44:24.029] [akka://RaftTest/user/member1] Follower redirect command: Command(0), leader=Some(Actor[akka://RaftTest/user/member4#915776548])
[INFO] [12/25/2023 20:44:24.030] [akka.actor.ActorSystemImpl(RaftTest)] Stop leader: Actor[akka://RaftTest/user/member4#915776548]
[INFO] [12/25/2023 20:44:26.773] [akka://RaftTest/user/member3] Follower election timeout
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member3] Candidate start election: currentTerm=2, requestedMembers=HashMap(Actor[akka://RaftTest/user/member4#915776548] -> 0, Actor[akka://RaftTest/user/member5#659633385] -> 0, Actor[akka://RaftTest/user/member3#2088407234] -> 1, Actor[akka://RaftTest/user/member2#882887653] -> 0, Actor[akka://RaftTest/user/member1#1214893844] -> 0)
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member5] Follower RequestVoteRPC receive RequestVote(2,Actor[akka://RaftTest/user/member3#2088407234],1,1)
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member5] Follower RequestVoteRPC return RequestVoteResult(2,true)
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member2] Follower RequestVoteRPC receive RequestVote(2,Actor[akka://RaftTest/user/member3#2088407234],1,1)
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member2] Follower RequestVoteRPC return RequestVoteResult(2,true)
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member1] Follower RequestVoteRPC receive RequestVote(2,Actor[akka://RaftTest/user/member3#2088407234],1,1)
[INFO] [12/25/2023 20:44:26.775] [akka://RaftTest/user/member1] Follower RequestVoteRPC return RequestVoteResult(2,true)
[INFO] [12/25/2023 20:44:26.776] [akka://RaftTest/user/member3] Candidate receive voted result: term=2
[INFO] [12/25/2023 20:44:26.776] [akka://RaftTest/user/member3] Candidate receive voted result: term=2
[INFO] [12/25/2023 20:44:26.776] [akka://RaftTest/user/member3] Candidate become to leader: nextIndex=Map(Actor[akka://RaftTest/user/member1#1214893844] -> 2, Actor[akka://RaftTest/user/member2#882887653] -> 2, Actor[akka://RaftTest/user/member4#915776548] -> 2, Actor[akka://RaftTest/user/member5#659633385] -> 2), matchIndex=Map(Actor[akka://RaftTest/user/member1#1214893844] -> 1, Actor[akka://RaftTest/user/member2#882887653] -> 1, Actor[akka://RaftTest/user/member4#915776548] -> 1, Actor[akka://RaftTest/user/member5#659633385] -> 1)
[INFO] [12/25/2023 20:44:26.777] [akka://RaftTest/user/member3] Leader send heartbeat to Actor[akka://RaftTest/user/member1#1214893844]: AppendEntries(2,Actor[akka://RaftTest/user/member3#2088407234],1,1,Vector(),1)
[INFO] [12/25/2023 20:44:26.777] [akka://RaftTest/user/member3] Leader send heartbeat to Actor[akka://RaftTest/user/member2#882887653]: AppendEntries(2,Actor[akka://RaftTest/user/member3#2088407234],1,1,Vector(),1)
...
```
:::

## ÊÑüÊÉ≥

### „ÇÑ„ÅØ„Çä„Çπ„ÉÜ„Éº„Éà„Éû„Ç∑„É≥„ÅÆÂÆüË£Ö„ÅØ Akka „ÅØ„ÇÑ„Çä„ÇÑ„Åô„ÅÑ

„Åù„ÅÆ„Åü„ÇÅ„ÅÆ„Ç¢„ÇØ„Çø„Éº„É¢„Éá„É´„Åß„Åô„ÄÅÊÑü„Åå„ÅÇ„Çä„Åæ„Åó„Åü„ÄÇ

Leader, Follower, Candidate „Åù„Çå„Åû„Çå„ÅÆÊåØ„ÇãËàû„ÅÑÂÆöÁæ©„ÇíÂàÜ„Åë„Å¶Ë®òËø∞„Åó„ÄÅÈ†ÜÊ¨°Âá¶ÁêÜ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Éô„Éº„Çπ„ÅßÁä∂ÊÖã„ÇÑÂÜÖÈÉ®„Çπ„ÉÜ„Éº„Éà„ÇíÂÆâÂÖ®„Å´Â§âÊõ¥„Åó„ÇÑ„Åô„Åè„ÄÅ„Ç≥„Éº„Éâ„ÅÆË¶ãÈÄö„Åó„Åå„Çà„ÅÑ„Çà„ÅÜ„Å´ÊÑü„Åò„Åæ„Åô„ÄÇ
Raft „ÅØ„Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÇíÂ•ëÊ©ü„Å´Áä∂ÊÖãÂ§âÂåñ„Çí„Åä„Åì„Åô„Åì„Å®„ÅåÂ§ö„ÅÑ„ÅÆ„Åß„Åô„Åå„ÄÅ„Åù„Çå„ÇÇ„Çπ„Ç±„Ç∏„É•„Éº„É©„Å®Ëá™Ë∫´„Å∏„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„É≥„Ç∞„Åß„Åô„Çì„Å™„ÇäÂÆüË£Ö„Åß„Åç„Åæ„Åó„Åü„ÄÇ

„Åæ„Åü„Åì„ÅÆ„Åæ„Åæ AkkaRemote „Çí„Å§„Åã„ÅÑ„ÄÅ„Éó„É≠„Çª„ÇπÈñì„ÅÆ„ÇÑ„Çä„Å®„Çä„ÇÇ„Åì„ÅÆ„Ç≥„Éº„Éâ„ÅÆ„Åæ„Åæ(„ÇÇ„Åó„Åè„ÅØ„Çø„Ç§„É†„Ç¢„Ç¶„ÉàÂÄ§„ÅÆË™øÊï¥)„ÅßÊ∏à„Åø„Åù„ÅÜ„Åß„ÄÅ„Ç¢„ÇØ„Çø„Éº„ÅÆ‰ΩçÁΩÆÈÄèÈÅéÊÄß„ÅÆÁâπÊÄß„ÇíÊ¥ªÁî®„Åß„Åç„Åù„ÅÜ„Åß„Åô„ÄÇ(„Éá„Éê„ÉÉ„Ç∞„Åå„Åó„ÇÑ„Åô„ÅÑ)

### State Êõ¥Êñ∞„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞

ÂÆüË£Ö„ÇíÈÄö„Åó„Å¶ÁñëÂïè„ÇíËß£Ê∂à„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åó„Åü„ÄÇ

Log Replication „Å´„Åä„ÅÑ„Å¶„ÄÅLeader „Åã„Çâ„ÅÆ AppendEntries „É™„ÇØ„Ç®„Çπ„Éà„Å´ÂØæ„Åó„ÄÅFollower „ÅØÊù°‰ª∂„ÉÅ„Çß„ÉÉ„ÇØ„ÅÆÂæå„Å´„É≠„Ç∞„ÇíËøΩÂä†„Åó„Å¶„É¨„Çπ„Éù„É≥„Çπ„ÇíËøî„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊôÇÁÇπ„Åß„ÅÆ„É≠„Ç∞„ÅØ„ÄÅLeader „Å´„Çà„Å£„Å¶„Ç≥„Éü„ÉÉ„Éà„Åï„Çå„Å™„ÅÑÂèØËÉΩÊÄß„ÇÇ„ÅÇ„Çã„Åü„ÇÅ„ÄÅ„Çπ„ÉÜ„Éº„Éà„Å´ apply „Åß„Åç„Åæ„Åõ„Çì„ÄÇ
„Åß„ÅØ„Å©„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„Åß apply „Åô„Çã„ÅÆ„Åã„Å®ÊÄù„Å£„Å¶„ÅÑ„Åü„Çâ„ÄÅ„É≠„Ç∞ËøΩÂä†„ÅÆ AppendEntries „É™„ÇØ„Ç®„Çπ„Éà„ÅÆÂæå„Å´„Åä„Åì„Å™„Çè„Çå„Çã„ÄÅ„Éè„Éº„Éà„Éì„Éº„Éà„Åæ„Åü„ÅØÂà•„ÅÆ„É≠„Ç∞ËøΩÂä†„ÅÆ„Åü„ÇÅ„ÅÆ AppendEntries ÊôÇ„Å´ apply „Åï„Çå„Çã„Åì„Å®„Åå„ÄÅ‰ªäÂõû„ÅÆÂÆüË£Ö„ÇíÈÄö„Åó„Å¶ÁêÜËß£„Åß„Åç„Åæ„Åó„Åü„ÄÇ

Leader „ÅØ„ÄÅÂêÑ Follower „Åå„Å©„Åì„Åæ„Åß„É≠„Ç∞„ÇíÊåÅ„Å£„Å¶„ÅÑ„Çã„Åã„ÇíÁÆ°ÁêÜ„Åó„Å¶„Åä„Çä„ÄÅAppendEntries „É™„ÇØ„Ç®„Çπ„ÉàÊôÇ„Å´ÊúÄÊñ∞„Åæ„Åß„ÅÆÂ∑ÆÂàÜ„É≠„Ç∞„ÅÆÊÉÖÂ†±„Å®„ÄÅleader „ÅØ„Åì„Åì„Åæ„Åß„Ç≥„Éü„ÉÉ„Éà„Åó„Å¶„ÅÑ„Çã„Å®„ÅÑ„ÅÜÊÉÖÂ†±„ÇÇÈÄÅ„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
Follower „ÅØÈùûÂêåÊúü„Å´„ÄÅ„Åù„ÅÆ Leader „ÅÆ„Ç≥„Éü„ÉÉ„Éà„É≠„Ç∞Áï™Âè∑„Åæ„Åß„Çí State „Å´ apply „Åô„ÇãÂΩ¢„Å´„Å™„Çä„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„Å£„Å¶„ÄÅ„ÅÇ„Çã„É≠„Ç∞„ÇíËøΩÂä†„Åó„ÅüÂæå„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Åß Leader „ÅÆ„Ç≥„Éü„ÉÉ„ÉàÁï™Âè∑„ÅåÈÄ≤„Çì„Åß„ÅÑ„Çå„Å∞ÈÅ©Áî®„Åô„Çã„Åì„Å®„ÅåÁêÜËß£„Åß„Åç„Åæ„Åó„Åü„ÄÇ

„Åü„Å†„Åó„Åì„Çå„ÅØ„ÄÅ**Leader „Åå Client „Åã„Çâ„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Å´Âøú„Åà„Çã**„Å®„ÅÑ„ÅÜË´ñÊñá„ÅÆÂâçÊèê„Å´„Åä„ÅÑ„Å¶„Å´„Å™„Çã„ÅÆ„Åß„ÄÅFollower „Åã„Çâ„ÇÇ„Éá„Éº„Çø„ÇíÂèÇÁÖß„Åô„Çã„Çà„ÅÜ„Å™Ë¶ÅÊ±Ç„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅÈùûÂêåÊúü„Å´ÈÅ©Áî®„Åï„Çå„ÇãÈÉ®ÂàÜ„Å´Ê≥®ÊÑè„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åù„ÅÜ„Åß„Åô„ÄÇ

### MembershipÁÆ°ÁêÜ

‰ªäÂõû„ÅØ Leader Election „Å® Log Replication „ÅÆÂÆüË£Ö„Å´„Å®„Å©„Åæ„Çä„Åæ„Åó„Åü„Åå„ÄÅ„Éé„Éº„Éâ„Åå„ÇØ„É©„Çπ„Çø„Çí‰Ωú„ÇäÂàÜÊï£Âá¶ÁêÜ„Åô„Çã„Åü„ÇÅ„Å´„ÅØ **Membership ÁÆ°ÁêÜ** „ÅåÈáçË¶Å„Åß„Åô(ÂàÜÊï£Âá¶ÁêÜ„ÅÆÊ†∏)„ÄÇ
Ë´ñÊñá„Å´„ÅØ„ÄÅMembership („ÇØ„É©„Çπ„Çø)Â§âÊõ¥„Å´„Çà„Çã„É≠„Ç∞„ÅÆÁßªË°å„Å´„Å§„ÅÑ„Å¶„ÅÆË®òËø∞„ÅØ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„Åù„ÇÇ„Åù„ÇÇ„Å©„ÅÆ„Çà„ÅÜ„Å´ Membership „ÇíÁÆ°ÁêÜ„Åô„Çã„Åã„Å´„Å§„ÅÑ„Å¶„ÅÆË®ÄÂèä„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ

ÊúÄÂàù„Å´ÊÄù„ÅÑ„Å§„Åè„ÅÆ„Åå„ÄÅMembership ÁÆ°ÁêÜËá™‰Ωì„ÇÇ Raft „Åß„Åä„Åì„Å™„ÅÑ„ÄÅ„Åù„ÅÆ Membership „Çí„Å§„Åã„Å£„Å¶‰ªñ„ÅÆ Raft „ÇØ„É©„Çπ„Çø„Çí„Å§„Åè„Çã„Å®„ÅÑ„ÅÜ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ
„Åæ„Åü Akka „Çí„Å§„Åã„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅMembership ÁÆ°ÁêÜ„ÅØ AkkaCluster „Åß„Åä„Åì„Å™„ÅÑ„ÄÅ„Åù„ÅÆ‰∏ä„Åß Raft „Çí„Å§„Åã„Å£„Å¶„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÇíÂÆüË£Ö„Åô„Çã„Åì„Å®„ÇÇÂèØËÉΩ„Åß„ÅØ„Å®ÊÄù„ÅÑ„Åæ„Åó„Åü„ÄÇ
(TIS „Åï„Çì„ÅÆ [lerna-stack/akka-entity-replication](https://github.com/lerna-stack/akka-entity-replication) „Åå„Åù„Çå„Å´Áõ∏ÂΩì„Åô„Çã„ÅÆ„Åã„ÇÇ)

## „Åæ„Å®„ÇÅ

- „ÇÑ„ÅØ„Çä Akka/Pekko „Å™„Å©„Ç¢„ÇØ„Çø„Éº„É¢„Éá„É´„Å® Raft „ÅÆ„Çπ„ÉÜ„Éº„Éà„Éû„Ç∑„É≥Ë®òËø∞„ÅØÁõ∏ÊÄß„ÅåËâØ„Åã„Å£„Åü
- ÂÆüË£Ö„Åó„Å¶„Åø„Çã„Åì„Å®„Åß„ÄÅÁêÜËß£„ÅåÊõñÊòß„Å™ÈÉ®ÂàÜ„Å´„Å§„ÅÑ„Å¶„Çà„ÇäÊòéÁ¢∫„Å´„Ç§„É°„Éº„Ç∏„Çí„Å§„Åë„Çã„Åì„Å®„Åå„Åß„Åç„Åü
    - „Äå„Åì„ÅÜ„ÅÑ„ÅÜ„Åì„Å®„Åå„Åß„Åç„Çã„ÅÆ„Åß„ÅØ„Å™„ÅÑ„Åã„Äç„ÅÆË©≥Á¥∞Â∫¶„Çí„Çà„ÇäÈ´ò„ÇÅ„Çâ„Çå„Çã

## ÂÆüË£Ö„ÅÆÂèÇËÄÉ„Å´„Åó„Åü„ÇÇ„ÅÆ

‰ªäÂõûÂÆüË£Ö„Åô„Çã„Å´„ÅÇ„Åü„Çä„ÄÅ‰∏ãË®ò„ÅÆÂÆüË£Ö„ÇÑÊÉÖÂ†±„ÇÇÂèÇËÄÉ„Å´„Åó„Åæ„Åó„Åü„ÄÇ

@[card](https://github.com/hashicorp/raft)

@[card](https://github.com/ktoso/akka-raft)

@[card](https://chat.openai.com/)
